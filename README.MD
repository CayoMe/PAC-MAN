# paCman, um Pacman em C

O jogo, rodando *estritamente* no console, funciona a partir de um loop localizado no `int main()` do documento `pacman.c`, que ocorre logo ap√≥s a exibi√ß√£o da tela inicial e alguns preparos 

**Este loop consiste em 3 fun√ß√µes principais:**
- [`moverJogador()`](#moverJogador) para pegar uma entrada do jogador, seja um movimento ou um comando, e process√°-la;
- [`moverFantasma()`](#moverfantasma): para mover os fantasmas de acordo com as suas personalidades; e
- [`renderGrid()`](#rendergrid): busca as informa√ß√µes do mapa ap√≥s todas as movimenta√ß√µes e printa no console cada uma das c√©lulas do mapa.
> *Dica:* - Os nomes de algumas fun√ß√µes s√£o links pra facilitar a navega√ß√£o. **Clique nelas** :^]


---
## As Entidades
### Pacman `C`
√â o jogador. Todas as vezes que a fun√ß√£o `makeMove()` √© chamada, o jogador dever√° pressionar uma das teclas permitidas: qualquer seta, (Q)uit, (R)einiciar.

### Fantasmas `F P I O`
S√£o monstrinhos que andam aleatoriamente pelo mapa e se, ao final do turno, as suas coordenadas forem iguais √† do Pacman, o jogador perde e o jogo acaba.
Possuem vari√°veis de coordenadas (`xPos` e `yPos`), de velocidade (`xVel` e `yVel`), e de `skin`. A *skin* √© o s√≠mbolo que aparece no mapa para representar o fantasma.
Em cada turno, as coordenadas do fantasma s√£o incrementadas por suas respectivas velocidades atr√°v√©s das l√≥gicas `yPos = yPos + yVel` para a coordenada das linhas, e `xPos = xPos + xVel` para a coordenada das colunas.
> *Exemplo:* um fantasma posicionado na c√©lula **(3, 7)** e com os os valores de velocidade `xVel = -1` e `yVel = 0` se movimentar√° para a c√©lula **(2, 7)** no turno seguinte. *Veja [coordenadas](#coordenadas).*

O c√≥digo garente que um dos valores de velocidade ser√° sempre 0, caso contr√°rio, o fantasma se moveria em diagonais.
Sempre que um fantasma fica de frente com uma parede, os valores de sua velocidade mudam para que no pr√≥ximo turno ele se mova em outra dire√ß√£o. H√° mais detalhes na descri√ß√£o da fun√ß√£o [`moverFantasma()`](#moverfantasma).

---

## Os Mapas
Para evitar que as l√≥gica do jogador e a dos fantasmas entrem em conflito, o jogador e os fantasmas vivem em mapas diferentes, o [mapa principal](#mapa-principal) e o [fantasmapa](#fantasmapa).
Estes mapas s√£o reflexos um do outro. Toda parede no mapa principal tamb√©m √© uma parede no fantasmapa. Apesar das [entidades](#as-entidades) habitarem mapas diferentes, o c√≥digo permite que elas se "comuniquem".

### Mapa principal
Referido apenas como *"mapa"*, √© o mapa em que o Pacman habita. Nele estar√£o presentes o [Pacman](#pacman), os pontos (que s√£o, adequadamente, `.` *pontos*), e os pont√µes `o` que valem mais pontos.

### Fantasmapa
√â o mapa em que os fantasmas habitam. Aqui √© s√≥ parede e fantasma mesmo.

---
## Coordenadas
Devido a como o C e outras linguagens de programa√ß√£o representam os √≠ndices de matrizes, h√° um pouco de espa√ßo para confus√£o na maneira em que nos referimos √†s coordenadas.
No plano de coordenadas cartesianas (x, y), "andar pra direita" √© incrementar o valor de x, enquanto "andar para cima" √© incrementar o valor de y.
Em matrizes, n√£o funciona bem assim. A linguagem C indexa as c√©lulas da esquerda pra direita, de cima pra baixo, assim como a nossa leitura, portanto, **o menor valor de x (colunas) fica na esquerda, enquanto o menor valor de y (linha) fica no topo.**
Em cima de tudo isso, para acessar uma c√©lula em uma matriz `char m[4][4]`, devemos cham√°-la da seguinte forma: `m[#linha][#coluna]`, ou seja **o valor de y vem primeiro.**
A tabela abaixo mostra a nota√ß√£o tanto em forma cartesiana quanto em indexa√ß√£o do C.

| .         | x = 0               | x = 1               | x = 2               | x = 3               |
|----------:|:-------------------:|:-------------------:|:-------------------:|:-------------------:|
| **y = 0** | (0, 0)<br>`m[0][0]` | (1, 0)<br>`m[0][1]` | (2, 0)<br>`m[0][2]` | (3, 0)<br>`m[0][3]` |
| **y = 1** | (0, 1)<br>`m[1][0]` | (1, 1)<br>`m[1][1]` | (2, 1)<br>`m[1][2]` | (3, 1)<br>`m[1][3]` |
| **y = 2** | (0, 2)<br>`m[2][0]` | (1, 2)<br>`m[2][1]` | (2, 2)<br>`m[2][2]` | (3, 2)<br>`m[2][3]` |
| **y = 3** | (0, 3)<br>`m[3][0]` | (1, 3)<br>`m[3][1]` | (2, 3)<br>`m[3][2]` | (3, 3)<br>`m[3][3]` |

Por conta disso, sempre que, no c√≥digo, √© necess√°rio referenciar alguma c√©lula no mapa, voc√™ ver√° algo do tipo: `fm[ fan->yPos + fan->yVel ][ fan->xPos + fan->xVel ]`. **O valor de y SEMPRE vir√° antes do valor de x**. √â confuso assim mesmo e t√° tudo bem üò∂ü§ô

---

## Fun√ß√µes

### `saveGame()`
`void saveGame(Player p, Fantasma f[])`
Utiliza a fun√ß√£o `fprintf()` para salvar o estado atual do jogo no arquivo `savefile.txt`. Salva apenas as coordenadas do Pacman e dos fantasmas.

### `carregarMapa()`
`void carregarMapa(char mapa[ROWS][COLS])`
Carrega o cen√°rio salvo em `savefile.txt`. Este carregamento √© efetuado utilizando a fun√ß√£o `fgets()` que l√™ linha por linha do arquivo. Caso a linha contenha um p como primeiro caractere, esta linha cont√©m informa√ß√µes do Pacman, caso contr√°rio, esta linha cont√©m informa√ß√µes de um fantasma.

### `reiniciarJogo()`
`void reiniciarJogo(Player *p, Fantasma f[], char mapa[ROWS][COLS])`
Coloca o Pacman e os fantasmas em suas posi√ß√µes originais, efetivamente reiniciando o jogo.

### getInput()
`char getInput()`
Utiliza a fun√ß√£o `getch()` da biblioteca `conio.h` para receber uma entrada do usu√°rio sem a necessidade de apertar enter no console para enviar o comando. A fun√ß√£o getch() √© meio complexa, mas ela basicamente guarda um `char` em uma vari√°vel `int`. Foi utilizado para processar o que o usu√°rio gostaria de fazer no pr√≥ximo turno, podendo este optar por se mover em uma das 4 dire√ß√µes (`u`, `d`, `l`, `r`) utilizando as setinhas, fechar o programa apertando **Q**, ou salvar o jogo apertando **S**.

### telaInicial()
`void telaInicial()`
Renderiza uma arte em ASCII colorida do Pacman cl√°ssico e espera o usu√°rio apertar enter para dar in√≠cio ao jogo.

### `gerarFantasmapa()`
`void gerarFantasmapa(char s[ROWS][COLS], char d[ROWS][COLS])`
Loopa por todo o mapa ‚Üí para cada c√©lula, se a c√©lula for uma parede `'‚ñà'`, escreve uma parede `'#'` no fantasmapa, se n√£o, escreve um espa√ßo `' '`.

### `renderGrid()`
`void renderGrid(char m[ROWS][COLS], char fm[ROWS][COLS], Player *player, Fantasma fantasmas[], int num_fantasmas, int *pontos)`
Posiciona o jogador e os fantasmas nas c√©lulas com suas coordenadas ‚Üí loopa por todas as coordenadas do mapa ‚Üí verifica se a c√©lula est√° vazia no fantasmapa, se estiver, printa a c√©lula do mapa, se n√£o estiver vazia, printa o fantasma.

### `moverJogador()`
`char moverJogador(Player *pacman, Fantasma fantasmas[], int rows, int cols, char mapa[ROWS][COLS], char fm[ROWS][COLS], int *pontos)`
Recebe a entrada do jogador com [getInput()](#getinput). Caso a entrada do jogador seja uma setinha, incrementa a posi√ß√£o do Pacman a depender da dire√ß√£o escolhida. Caso a entrada seja um comando, chama as fun√ß√µes [`reiniciarJogo()`](#reiniciarjogo) ou [`saveGame()`](#saveGame).

### `moverFantasma()`
`void moverFantasma(Fantasma *fan, char fm[ROWS][COLS], Player p)`
Apaga a c√©lula que o fantasma estava ‚Üí escolhe o alvo do fantasma de acordo com a sua personalidade ‚Üí escreve a `skin` do fantasma na posi√ß√£o que o fantasma se mover√° ‚Üí altera os valores das coordenadas do fantasma para os da nova c√©lula ‚Üí "olha" qual ser√° a pr√≥xima c√©lula, se estiver vazia nada acontece, se for uma parede, chama [`mudarDirecao()`](#mudardirecao) para alterar as velocidades do fantasma.

### `mudarDirecao()`
`mudarDirecao(Fantasma *fan, char fm[ROWS][COLS], int alvoY, int alvoX)`
Escolhe qual dire√ß√£o √© a melhor para o colocar mais pr√≥ximo de seu alvo. Se o caminho √© inv√°lido, o fantasma d√° uma meia volta.

---

### Debugs
Em alguns locais do c√≥digo est√£o presentes o coment√°rio `// DEBUG` seguido de um n√∫mero. **Ex:** `// DEBUG 2`.
Estas linhas servem como algumas ferramentas visuais que podem ser utilizadas para debugar o jogo. Coment√°-las faz com que elas n√£o apare√ßam mais no console, permitindo ver como o jogo seria ao finaliz√°-lo.
> Dica: Use `crtl + F` para buscar o debug espec√≠fico que quer habilitar/desabilitar, selecione o texto, `ctrl + shift + L` para criar um cursor em cada debug, `ctrl + ;` para comentar todas as linhas.

---

## Refer√™ncias:
- [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/HTML)
- [Cheatsheet do C](https://manual.cs50.io/)
- [Playsound](https://learn.microsoft.com/pt-pt/previous-versions//dd743680(v=vs.85))
- [`conio.h`](https://code-reference.com/c/conio.h)
- [Fantasmas e suas personalidades](https://www.quora.com/What-are-the-different-gameplay-of-the-ghosts-in-the-classic-80s-video-game-Pac-Man)


> *paCman foi um jogo feito com muito amor (e uso quase nulo de IA, sendo usada como refer√™ncia aos compiladores de C / CMD) por 5 estudantes do curso de Ci√™ncia da Computa√ß√£o.*